#!/bin/sh
VERSION=$1; shift

. setenv.sh

cd /etc/openldap/data/
sed -e "s%dc=dcm4che,dc=org%${LDAP_BASE_DN}%" \
    -e "s%dicomDeviceName=dcm4chee-arc%dicomDeviceName=${ARCHIVE_DEVICE_NAME}%" \
    -e "s%dicomAETitle=DCM4CHEE%dicomAETitle=${AE_TITLE}%" \
    -e "s%dicomAETitle=IOCM_REGULAR_USE%dicomAETitle=${AE_TITLE_IOCM_REGULAR_USE}%" \
    -e "s%dicomAETitle=IOCM_QUALITY%dicomAETitle=${AE_TITLE_IOCM_QUALITY}%" \
    -e "s%dicomAETitle=IOCM_PAT_SAFETY%dicomAETitle=${AE_TITLE_IOCM_PAT_SAFETY}%" \
    -e "s%dicomAETitle=IOCM_WRONG_MWL%dicomAETitle=${AE_TITLE_IOCM_WRONG_MWL}%" \
    -e "s%dicomAETitle=IOCM_EXPIRED%dicomAETitle=${AE_TITLE_IOCM_EXPIRED}%" \
    -e "s%dicomAETitle=AS_RECEIVED%dicomAETitle=${AE_TITLE_AS_RECEIVED}%" \
    -e "s%dcmWebAppName=dcm4chee-arc%dcmWebAppName=${ARCHIVE_WEBAPP_NAME}%" \
    -e "s%dcmWebAppName=DCM4CHEE%dcmWebAppName=${AE_TITLE}%" \
    -e "s%dcmWebAppName=IOCM_REGULAR_USE%dcmWebAppName=${AE_TITLE_IOCM_REGULAR_USE}%" \
    -e "s%dcmWebAppName=IOCM_QUALITY%dcmWebAppName=${AE_TITLE_IOCM_QUALITY}%" \
    -e "s%dcmWebAppName=IOCM_PAT_SAFETY%dcmWebAppName=${AE_TITLE_IOCM_PAT_SAFETY}%" \
    -e "s%dcmWebAppName=IOCM_WRONG_MWL%dcmWebAppName=${AE_TITLE_IOCM_WRONG_MWL}%" \
    -e "s%dcmWebAppName=IOCM_EXPIRED%dcmWebAppName=${AE_TITLE_IOCM_EXPIRED}%" \
    -e "s%dcmWebAppName=AS_RECEIVED%dcmWebAppName=${AE_TITLE_AS_RECEIVED}%" \
    -e "s%archive-host%${ARCHIVE_HOST}%" \
    add-http-conns.ldif | ldapmodify -xw ${LDAP_ROOTPASS} -D cn=admin,${LDAP_BASE_DN} -H "$LDAP_URLS" $@
