#!/bin/sh

. setenv.sh

sed -e "s%dc=dcm4che,dc=org%${LDAP_BASE_DN}%" \
    -e "s%uid=user%uid=${AUTH_USER}%" \
    -e "s%uid: user%uid: ${AUTH_USER}%" \
    -e "s%cn=user%cn=${AUTH_USER_ROLE}%" \
    -e "s%cn: user%cn: ${AUTH_USER_ROLE}%" \
    -e "s%uid=admin%uid=${SUPER_USER}%" \
    -e "s%uid: admin%uid: ${SUPER_USER}%" \
    -e "s%cn=admin%cn=${SUPER_USER_ROLE}%" \
    -e "s%cn: admin%cn: ${SUPER_USER_ROLE}%" \
    -e "s%uid=keycloak-admin%uid=${KEYCLOAK_ADMIN_USER}%" \
    -e "s%uid: keycloak-admin%uid: ${KEYCLOAK_ADMIN_USER}%" \
    -e "s%uid=wildfly-admin%uid=${WILDFLY_ADMIN_USER}%" \
    -e "s%uid: wildfly-admin%uid: ${WILDFLY_ADMIN_USER}%" \
    /etc/openldap/data/add-keycloak-admin.ldif \
| ldapmodify -xw ${LDAP_ROOTPASS} -D cn=admin,${LDAP_BASE_DN} -H "$LDAP_URLS" $@
