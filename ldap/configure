#!/bin/sh

ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/dicom.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/dcm4che.ldif
ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/dcm4chee-archive.ldif

cd /etc/ldap/data
for f in init-config.ldif default-config.ldif add-vendor-data.ldif; do
	sed -e "s/dc=dcm4che,dc=org/${LDAP_BASE_DN}/" \
		-e "s/dcm4chee-arc/${DEVICE_NAME}/" \
		-e "s/DCM4CHEE/${AE_TITLE}/" \
		-e "s|/var/local/dcm4chee-arc/fs1/|${STORAGE_DIR}|" \
		$f | ldapadd -xw ${LDAP_ROOTPASS} -Dcn=admin,${LDAP_BASE_DN}
done
